{% extends 'base.html' %}
{% load static %}
{% load crispy_forms_tags %}
{% block title %}Uploads{% endblock %}



{% block body_block %}
<div class = "jumbotron" style="background-color: orange;color:white;text-align: center;">

<h2>Images uploaded</h2>
</div>

{% if request.user.is_authenticated %}
<div class="container">
	<div class="row">
		<div class="col-lg-3" style="text-align:center;">
<span class="glyphicon glyphicon-log-in">
<img src="/media/profile_pics/self.jpg" width="30px" height="30px" class="rounded-circle" >
 Welcome,
	<a href= "{% url 'profile' username=request.user %}">{{request.user}}</a>
	</span>
</div>

	<div class ="col-lg-1" style="text-align:center;">
		<a href="{% url 'display' %}"><span>Show All</span>
	</div>

	<div class ="col-lg-3" style="text-align:center;">
		<a href="{% url 'display_by_user' %}"><span>Show uploaded by {{request.user}} only</span>
	</div>

{% comment %}
		<div class="col-lg-2" style="text-align:center;">
<a href = "{% url 'upload' %}"><span>Upload More...</span></a>
</div>
{% endcomment %}

<div class="col-lg-2" style="text-align:center;">
<a href="{% url 'logout' %}"><span><i class="fa fa-sign-out" aria-hidden="true"></i></span>
	Log out</a>
</div>
<div class="col-lg-3" style = "text-align:center;">
<a href="#" data-toggle="modal" data-target="#myModal">Upload more...</a>
</div>


<!-- The Modal -->
<div class="modal" id="myModal">
	<div class="modal-dialog">
		<div class="modal-content">

			<!-- Modal Header -->
			<div class="modal-header">
				<h4 class="modal-title">Post Photo</h4>
				<button type="button" class="close" data-dismiss="modal">&times;</button>
			</div>

			<!-- Modal body -->
			<div class="modal-body">
				<form method="post" enctype="multipart/form-data">
	{{ form|crispy }}
	{% csrf_token %}
	<button type="submit" class="btn btn-info btn-sm" name="img_upload">Upload</button>

</form>

</div>

			<!-- Modal footer -->
			<div class="modal-footer">
				<button type="button" class="btn btn-danger" data-dismiss="modal">Cancel</button>
			</div>

		</div>
	</div>
</div>



</div>
</div>

<hr>

	{% for image in images %}
		<div class = "container">
			<div class="row">
				<div class="col-lg-2" style = "text-align: center;">
					<!-- <strong>Column 1</strong> -->
				</div>

<div class="col-lg-8">
	{% comment %}
	{% if image.isVideo == 0 %}
		<font color = 'blue'>image</font>
	{% endif %}
	{% endcomment %}

	<p>		<font color ="red">
		{{ image.uploaded_by }}</font> says..</p>
		<strong>{{image.your_say}}</strong><br>
			<a href="#">
			<div>
				{% if image.isVideo == 0 %}
		<img src="{{ image.your_image.url }}" class="img-responsive"
                   style="width: 70%;  display:auto;" />
				{% else %}
		<video width="400" height="300" autoplay muted controls>
			<source src="{{MEDIA_URL}}{{image.your_image.url}}" type = "video/mp4">
	 	Your browser doesn't support video tag.</video>
			{% endif %}
		 </div>
   </a>
	 <p><small>on {{ image.upload_date|date:"D d M Y"  }}&nbsp;&nbsp;		at {{image.upload_date|time:"g:i A T"}}
		</small></p>

		<br>

	{% if image.pk in liked_post_list  %}
  <span class="badge badge-pill badge-primary" style="font-size:16px;">
		<a href="{% url 'unlike' pk=image.pk %}"><i class="fa fa-heart" aria-hidden="true"
			style="font-size:28px;color:red"></i></a>&nbsp;

			{% comment %}
				The following three lines of code will lookup the likes_dict dictionary
				and extract the number of likes  on a post.
			{% endcomment %}

		{% for k,v in likes_dict.items %}
			{% if k == image.pk %}
			{{v}}
			{% endif %}
		{% endfor %}

	{% else %}

		<a href="{% url 'like' pk=image.pk %}"><i class="far fa-heart" aria-hidden="true"
			 style="font-size:28px;color:red"></i></a>&nbsp;
			 {% for k,v in likes_dict.items %}
				 {% if k == image.pk %}
				 {{v}}
				 {% endif %}
			 {% endfor %}
	{% endif %}
	</span>

	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;

	<a href="{% url 'shared' pk=image.pk %}">Shares</a>&nbsp;
	{% for k1,v1 in shares_dict.items %}
		{% if k1 == image.pk %}
		{{v1}}
		{% endif %}
	{% endfor %}

	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;

<a href="{% url 'add_comment' pk=image.pk %}">Comment</a>&nbsp;&nbsp;&nbsp;

	{% for k,v in comments_dict.items %}
	{% if k == image.pk %}
<span class="badge badge-info" style="font-size:16px;">
		{{v}}
</span>
	{% endif %}


	{% endfor %}
<br>
 <p style="display:inline" id = 'displaynone' value='image_pk'>{{image.pk}}
&nbsp;&nbsp;&nbsp;&nbsp;
<a href="#" class = 'test' data-id = "{{image_pk}}" >TEST</a>
 </p>

</div>

	{# <a href="{% url 'delete_items' image.id %}"><span>Delete</span></a> #}
 <hr>
	</div>


	</div>

<br>
{% endfor %}

{% else %}
<strong>You must sign in to view images. If you don't have an accout, create one!</strong>
<li><a href="{% url 'user_login' %}"><span class="glyphicon glyphicon-user"></span> Log in</a></li>
<li><a href="{% url 'signup' %}"><span class="glyphicon glyphicon-user"></span> Sign Up</a></li>
{% endif %}



	<script>
	$(document).ready(function(){
	  $('[data-toggle="popover"]').popover();
	});

	{% block domready %}
	$('a.test').click(function(e){
	e.preventDefault();
$.post('{% url "test" %}',
{
	id: $(this).data('id'),
	td:"this is a test",
},
function (data){

}

);
});
	{% endblock %}
	</script>



{% endblock %}
